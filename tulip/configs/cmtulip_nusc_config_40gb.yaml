# Example KITTI Configuration for TULIP LiDAR Upsampling
# This file shows how to configure TULIP for KITTI dataset

# Model selection and architecture
model_select: 'CMTULIP'  # Use base TULIP model for KITTI
window_size: [2, 8]
depths: [2,6,2]
patch_size: [1, 4]
pixel_shuffle: true  # improve
circular_padding: true  # improve
patch_unmerging: true  # improve
swin_v2: false
im2col_step: 288
lss_weights_path: '' 

# Backbone configuration for KITTI
backbone:
  # Image backbone configuration
  img_backbone_conf:
    type: 'ResNet'
    depth: 50
    frozen_stages: 0
    out_indices: [0, 1, 2, 3]
    norm_eval: false
    init_cfg:
      type: 'Pretrained'
      checkpoint: 'torchvision://resnet50'
  
  # Image neck configuration
  img_neck_conf:
    type: 'FPN'
    in_channels: [256, 512, 1024, 2048]
    out_channels: 128
    start_level: 0
    add_extra_convs: 'on_output'
    num_outs: 4
    relu_before_extra_convs: True

# Dataset configuration for KITTI
dataset_select: 'nuscenes_with_image'
img_size_low_res: [8, 1024]  # KITTI dimensions from bash script
img_size_high_res: [32, 1024]
in_chans: 1
data_path_low_res: './data/nuscenes/'

# Data processing options
save_pcd: false  # Save PCD output for KITTI evaluation
log_transform: false  # improve
keep_close_scan: false
keep_far_scan: false

# Training configuration
batch_size: 8  # From bash script
epochs: 600
accum_iter: 1
weight_decay: 0.01  # From bash script
lr: 0.001  # lr=0.0005 for 4gpus x 8 batch size = 32 effective batch size we have 8gpus and batch size 8
blr: 0.001
min_lr: 0.0
warmup_epochs: 60  # From bash script
phase2_start: 0 # 0.2 * epochs

# Checkpoint and logging
output_dir: './experiment/nusc/R80_FulResHybrid_SingleDepthQueryL1_SinglePhaseTrain_NoInit_b8_20260101_065507'
log_dir: './output_dir'
save_frequency: 100
num_workers: 4
pin_mem: true

# Evaluation configuration
mc_drop: true  # Enable Monte Carlo dropout
num_mcdropout_iterations: 50
noise_threshold: 0.03
grid_size: 0.1

# Logging and monitoring
wandb_disabled: false
entity: 'pnp_dnp'
project_name: 'upsample'
run_name: 'R80_FulResHybrid_SingleDepthQueryL1_SinglePhaseTrain_NoInit_b8'

# Device configuration
device: 'cuda'
seed: 42
resume: ''
start_epoch: 0
distributed: true
world_size: 1
dist_on_itp: false
local_rank: -1
dist_url: 'env://'
gpu: 0
